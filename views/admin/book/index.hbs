<div class="card">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between">
            <h5 class="card-title">{{title}}</h5>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newProduct">
                Yangi kitob
            </button>
        </div>
        <table class="table invoice-table">
            <thead>
                <tr>
                    <th scope="col">â„–</th>
                    <th scope="col">Kitob nomi</th>
                    <th scope="col">Bo'lim</th>
                    <th scope="col">Holati</th>
                    <th scope="col">Top</th>
                    <th scope="col">Yangi</th>
                    <th scope="col">Tartibi</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                {{#each book}}
                <tr>
                    <td>{{increment @index}}</td>
                    <td><img src='/{{img}}' width="50"/> {{title}}</td>
                    <td>{{atribut.title}}</td>
                    <td><a href="/admin/book/status/{{_id}}">{{{status}}}</a></td>
                    <td><a href="/admin/book/top/{{_id}}">{{{top}}}</a></td>
                    <td><a href="/admin/book/news/{{_id}}">{{{news}}}</a></td>
                    <td>{{order}}</td>
                    <td class="ml-auto text-right">
                        <a href="/admin/book/view/{{_id}}"><i data-feather="eye"></i></a>
                        <a href="/admin/book/delete/{{_id}}" onclick="return confirm('O`chirmoqchimisiz?')">
                            <i data-feather="x"></i>
                        </a>
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</div>
<div class="modal fade" id="newProduct" tabindex="-1" aria-labelledby="exampleModalLabel" style="display: none;"
    aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Yangi kitob</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/admin/book?_csrf={{csrf}}" method="post" class="needs-validation" novalidate enctype="multipart/form-data" name="newbook">
                <input type="hidden" name="atributes">
                    <div class="row">
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="title" class="form-label">Nomi</label>
                                <input type="text" name="title" class="form-control" id="title" required placeholder="Nomini kiriting">
                                <div class="invalid-feedback">Majburiy</div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="validationCustom04" class="form-label">Bo'lim</label>
                                <select name="atribut" class="form-select" id="validationCustom04" required="">
                                <option selected="" disabled="" value="">Bo'limni tanlang</option>
                                {{#each atribut}}
                                    <option value="{{_id}}">{{title}}({{category.title}})</option>
                                {{/each}}
                                </select>
                                <div class="invalid-feedback">Tanlang</div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="year" class="form-label">Kitob chiqarilgan yili</label>
                                <input type="number" name="year" class="form-control" id="year" placeholder="Kitob chiqarilgan yili">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="author" class="form-label">Kitob muallifi</label>
                                <input type="text" name="author" class="form-control" id="author"  placeholder="Kitob muallifi">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="nashr" class="form-label">Nashriyot</label>
                                <input type="text" name="nashr" class="form-control" id="nashr"  placeholder="Nashriyot nomi">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="tarjimon" class="form-label">Tarjimon</label>
                                <input type="text" name="tarjimon" class="form-control" id="tarjimon"  placeholder="Tarjimon ismi">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="language" class="form-label">Kitob qaysi tilda</label>
                                <input type="text" name="language" class="form-control" id="language"  placeholder="Kitob tili">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class=" mb-3">
                                <label for="count" class="form-label">Sahifalar soni</label>
                                <input type="number" name="count" class="form-control" id="count"  placeholder="Sahifalar sonini kiriting">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class=" mb-3">
                                <label for="order" class="form-label">Tartibi</label>
                                <input type="number" name="order" class="form-control" id="order"  placeholder="Tartibi">
                            </div>
                        </div>
                        <div class="col-12 col-md-12">
                            <div class="mb-3">
                                <label for="text">Kitob haqida ma'lumot</label>
                                <textarea name="text" class="form-control" id="text1"  placeholder="Kitob haqida ma'lumot yozing" value=" "></textarea>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="img1" class="form-label">Kitob muqovasi</label>
                                <input class="form-control" type="file" multiple id="img1" name="img1">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <div class="mb-3">
                                <label for="file1" class="form-label">Kitob fayli</label>
                                <input class="form-control" type="file" multiple id="file1" name="file">
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-12">
                            <label class="form-label">Kitob holati</label>
                            <div class="mb-3 d-flex align-items-center justify-content-around">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" name="top" value="1" type="checkbox" id="top">
                                    <label class="form-check-label" for="top">Top kitob</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" name="news" value="1" type="checkbox" id="news" >
                                    <label class="form-check-label" for="news">Yangi kitob</label>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" name="status" value="1" type="checkbox" id="active" checked>
                                    <label class="form-check-label" for="active">Aktiv</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Saqlash</button>
                </form>
            </div>
            <div class="modal-footer"></div>
        </div>
    </div>
</div>
<script src="https://cdn.ckeditor.com/ckeditor5/34.1.0/classic/ckeditor.js"></script>
<script>
     ClassicEditor
      .create( document.querySelector( '#text1' ) )
      .then( editor => {
              console.log( editor );
      } )
      .catch( error => {
              console.error( error );
      } );
    let newProduct = document.forms.newbook
    newProduct.addEventListener('submit',(e)=>{
        e.preventDefault()
        let formData = new FormData(newbook)
        fetch('/admin/book',{
            method:'post',
            body:formData,
        }).then(res=>res.json())
        .then(data=>{
            console.log(data)
            location.reload()
        })
    })
</script>